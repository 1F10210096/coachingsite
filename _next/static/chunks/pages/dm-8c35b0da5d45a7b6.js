(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{7622:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dm",function(){return n(2661)}])},2661:function(e,s,n){"use strict";n.r(s);var t=n(5893),a=n(4857),l=n(1163),i=n(7294),o=n(9093),d=n(7952),r=n.n(d);s.default=()=>{var e;let[s,n]=(0,i.useState)(""),[d,c]=(0,i.useState)(""),[m,_]=(0,i.useState)(""),[u,g]=(0,i.useState)(""),[p,h]=(0,i.useState)([]),[x,v]=(0,i.useState)(null),[N,j]=(0,i.useState)(void 0),f=(0,l.useRouter)(),C=f.query.id,fetchRecruitDetail=async()=>{try{console.log(s);let e=await o.x.userReview.post({body:{Id:s}});if(console.log(e),j(e.body),"string"==typeof C){let e=await o.x.fetachRoomRecruitDetail.post({body:{Id:C}});console.log(e),v(e.body)}}catch(e){console.error("ゲームの取得に失敗しました:",e)}};(0,i.useEffect)(()=>{s&&fetchRecruitDetail()},[s]),(0,i.useEffect)(()=>{let e=(0,a.v0)(),s=(0,a.Aj)(e,e=>{e&&(console.log(e),n(e.uid))});return()=>s()},[]);let fetchRoom=async()=>{try{if("string"==typeof C){let e=await o.x.fetchRoom.post({body:{Id:C,userId:s}});console.log(e)}}catch(e){console.error("ゲームの取得に失敗しました:",e)}};(0,i.useEffect)(()=>{s&&fetchRoom()},[s]);let[y,I]=(0,i.useState)(null),[B,k]=(0,i.useState)("");(0,i.useEffect)(()=>{if("string"==typeof s&&""!==s.trim()){let e=new WebSocket("ws://localhost:8000?userId=".concat(s));return console.log(e),e.onopen=function(){console.log("サーバーに接続しました"),e.send("こんにちは、サーバー！")},e.onmessage=function(e){let s=JSON.parse(e.data);console.log("[message] データを受信しました: ",s),"url"===s.type?(L(s.url),P(s.time),E(s.date),A(!1),console.log("承諾用URLを受信しました:",s.url),console.log(s.gameId),k(s.gameId),console.log(x)):"new-message"===s.type?(console.log("新しいメッセージを受信しました:",s),h(e=>[...e,s])):fetchRoom()},I(e),()=>{e.close()}}},[s]),console.log(p);let createApprovalUrl=e=>"https://yourapp.com/approve?roomId=".concat(e),sendApply=async()=>{if(!y||y.readyState!==WebSocket.OPEN){console.error("WebSocketが開いていません");return}if("string"==typeof C){let e=createApprovalUrl(C),n={type:"apply",roomId:C,userId:s,userNumber:m,url:e,gameTitle:null==x?void 0:x.title,gameId:null==x?void 0:x.gameId,date:O,time:M};y.send(JSON.stringify(n)),console.log("承諾用URLを送信しました:",e),window.confirm("承諾用URLを送信しました")}},handleUrlClick=async()=>{A(!1);let e=window.confirm("本当に承諾しますか？");if(e){console.log(U),console.log(C),console.log(s);try{"string"==typeof C&&"string"==typeof U&&"string"==typeof u&&"string"==typeof s&&await o.x.recruitApprove.post({body:{Id:U,bosyuuId:u,roomId:C,userId:s}})}catch(e){console.error("Error updating status:",e)}}},[S,R]=(0,i.useState)(!1),[T,w]=(0,i.useState)(!1),[b,A]=(0,i.useState)(!1),onCloseRecruit=()=>{R(!1)},onFinalClose=()=>{R(!1)},onApplyRecruit=()=>{R(!1),w(!0)},onApplyFinalRecruit=()=>{w(!1),sendApply()},[O,E]=(0,i.useState)(""),[M,P]=(0,i.useState)(""),handleDateChange=e=>{E(e.target.value)},handleTimeChange=e=>{P(e.target.value)},[U,L]=(0,i.useState)("");return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:r().container}),(0,t.jsxs)("div",{className:r().parent,children:[(0,t.jsxs)("div",{className:r().messageBox,children:[(0,t.jsxs)("div",{className:r().messageBox2,children:[(0,t.jsx)("div",{className:r().messageBox1,children:"チャット欄"}),(0,t.jsx)("div",{className:r().line})]}),(0,t.jsx)("div",{className:r().messageBox3,children:Array.isArray(p)&&p.map((e,s)=>(0,t.jsx)("div",{className:1===e.userIdentity?r().messageLeft:r().messageRight,children:(0,t.jsxs)("div",{className:r().messageContainer,children:[(0,t.jsx)("img",{src:e.userImageUrl,alt:"User",className:r().userImage2}),(0,t.jsx)("div",{className:r().msgContent,children:e.content})," "]})},s))}),(0,t.jsx)("div",{className:r().line2}),(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{type:"text",value:d,onChange:e=>c(e.target.value),className:r().messageInput}),(0,t.jsx)("button",{onClick:()=>{if(!y||y.readyState!==WebSocket.OPEN){console.error("WebSocketが開いていません");return}let e={type:"message",userImageUrl:null==N?void 0:N.imageUrl,roomId:C,userId:s,content:d};console.log(e),y.send(JSON.stringify(e)),fetchRoom()},className:r().sendButton,children:"Send"}),"1"===m&&(0,t.jsx)("button",{onClick:()=>{R(!0)},className:r().applayButton,children:"申し込む"}),S&&(0,t.jsx)(function(e){let{isOpen:s}=e;return s?(0,t.jsx)("div",{className:r().modal,children:(0,t.jsxs)("div",{className:r().modalContent,children:[(0,t.jsxs)("div",{className:r().modalMsgContent,children:[(0,t.jsx)("div",{className:r().modalTitle,children:"お申込み確認"}),(0,t.jsx)("div",{className:r().modalMsg,children:"日付と時間を設定してください"}),(0,t.jsxs)("div",{className:r().dateTimePicker,children:[(0,t.jsx)("input",{type:"date",className:r().dateInput,value:O,onChange:handleDateChange}),(0,t.jsx)("input",{type:"time",className:r().timeInput,value:M,onChange:handleTimeChange})]})]}),(0,t.jsx)("button",{className:r().closeButton,onClick:onCloseRecruit,children:"閉じる"}),(0,t.jsx)("button",{className:r().applyButton2,onClick:onApplyRecruit,children:"申し込む"})]})}):null},{isOpen:S}),T&&(0,t.jsx)(function(e){let{isOpen:s}=e;return s?(0,t.jsx)("div",{className:r().modal,children:(0,t.jsxs)("div",{className:r().modalContent,children:[(0,t.jsxs)("div",{className:r().modalMsgContent,children:[(0,t.jsx)("div",{className:r().modalTitle,children:"最終お申込み確認"}),(0,t.jsx)("p",{className:r().title,children:null==x?void 0:x.title}),(0,t.jsx)("p",{className:r().title,children:null!==x&&(null==x?void 0:x.gameId)!==null&&(e=>{switch(e){case 1:return"VALORANT";case 2:return"APEX";case 3:return"LOL";default:return"Unknown Game"}})(x.gameId)}),(0,t.jsxs)("div",{className:r().dateMsg,children:["日時：",O]}),(0,t.jsxs)("div",{className:r().timeMsg,children:["時間：",M]}),(0,t.jsx)("div",{children:"本当に申し込みますか？"})]}),(0,t.jsx)("button",{className:r().closeButton,onClick:onFinalClose,children:"閉じる"}),(0,t.jsx)("button",{className:r().applyButton2,onClick:onApplyFinalRecruit,children:"申し込む"})]})}):null},{isOpen:T}),U&&"2"===m&&(0,t.jsx)("div",{onClick:()=>{A(!0)},className:r().applayButton2,children:"受諾ボタン"}),b&&(0,t.jsx)(function(e){let{isOpen:s}=e;return s?(console.log(B),console.log(null==x?void 0:x.gameId),(0,t.jsx)("div",{className:r().modal,children:(0,t.jsxs)("div",{className:r().modalContent,children:[(0,t.jsxs)("div",{className:r().modalMsgContent,children:[(0,t.jsx)("div",{className:r().modalTitle,children:"最終受諾確認"}),(0,t.jsx)("p",{className:r().title,children:null==x?void 0:x.title}),(0,t.jsxs)("p",{className:r().title,children:[" ",null!==x&&(null==x?void 0:x.gameId)!==null&&(e=>{switch(e){case 1:return"VALORANT";case 2:return"APEX";case 3:return"LOL";default:return"Unknown Game"}})(x.gameId)]}),(0,t.jsxs)("div",{className:r().dateMsg,children:["日時：",O]}),(0,t.jsxs)("div",{className:r().timeMsg,children:["時間：",M]}),(0,t.jsx)("div",{children:"本当に了承しますか？"})]}),(0,t.jsx)("button",{className:r().closeButton,onClick:onFinalClose,children:"閉じる"}),(0,t.jsx)("button",{className:r().applyButton2,onClick:handleUrlClick,children:"了承する"})]})})):null},{isOpen:b})]})]}),(0,t.jsxs)("div",{className:r().profileContainer,children:[(0,t.jsx)("img",{src:null==N?void 0:N.imageUrl,alt:null==N?void 0:N.name,className:r().userImage}),(0,t.jsx)("div",{className:r().nameContainer,children:(0,t.jsx)("div",{className:r().name,children:null==N?void 0:N.name})}),(0,t.jsx)("div",{className:r().ratingContainer,children:(0,t.jsxs)("span",{className:r().rate,children:["★★★★★",(null==N?void 0:N.rating)&&(0,t.jsx)("span",{className:r().rateInner,style:{width:"".concat((console.log(30*(e=N.rating)),30*e),"px")},children:"★★★★★"})]})}),(0,t.jsx)("div",{className:r().rating,children:null==N?void 0:N.rating}),(0,t.jsxs)("div",{className:r().achievementsContainer,children:[(0,t.jsx)("div",{className:r().achievementsTitle,children:"【実績】"}),(0,t.jsx)("div",{className:r().achievements,children:null==N?void 0:N.Achievements})]}),(0,t.jsxs)("div",{className:r().descriptionDetailContainer,children:[(0,t.jsx)("div",{className:r().descriptionTitle,children:"【自己紹介】"}),(0,t.jsx)("div",{className:r().descriptions,children:null==N?void 0:N.hitokoto})]})]})]})]})}},7952:function(e){e.exports={loginContainer:"dm_loginContainer__CCPlz",loginForm:"dm_loginForm__830B9",loginButton:"dm_loginButton__bYjr2",container:"dm_container__2f5yO",loginTitle:"dm_loginTitle__eKnWK",kaninn:"dm_kaninn__gjHtq",searchmail:"dm_searchmail__2PwK5",searchInput:"dm_searchInput__wQgq8",mail:"dm_mail__Bid1P",password:"dm_password__KmriP",searchpass:"dm_searchpass__13_MN",messageInput:"dm_messageInput__eN8v9",sendButton:"dm_sendButton__yskkT",message:"dm_message__mIpbB",left:"dm_left__SxOKW",right:"dm_right__8zo2a",messageLeft:"dm_messageLeft__EmXrF",messageRight:"dm_messageRight__4t_2j",messageContainer:"dm_messageContainer__2_NLT",msgContent:"dm_msgContent__Ey1f4",userImage2:"dm_userImage2__GHH_u",messageBox:"dm_messageBox__yUvsV",messageBox3:"dm_messageBox3__BNIuO",messageBox2:"dm_messageBox2__9nfCa",messageBox1:"dm_messageBox1__xp6lP",line:"dm_line__X6Bnx",line2:"dm_line2__15k7S",applayButton:"dm_applayButton__ksAaZ",applayButton2:"dm_applayButton2__Plf02",profileContainer:"dm_profileContainer__o_e3U",userImage:"dm_userImage__vYxfZ",ratingContainer:"dm_ratingContainer__b72h9",rate:"dm_rate__vTFSP",rateInner:"dm_rateInner__rRs1E",rating:"dm_rating__AuLoY",name:"dm_name__fgJC8",nameContainer:"dm_nameContainer__tOq_9",achievementsContainer:"dm_achievementsContainer__AyLKI",achievements:"dm_achievements__PScWa",achievementsTitle:"dm_achievementsTitle__dvWMy",descriptionDetailContainer:"dm_descriptionDetailContainer__g8IjQ",descriptionTitle:"dm_descriptionTitle__g1_R6",descriptions:"dm_descriptions__CxZbx",parent:"dm_parent__Sx_RC",modal:"dm_modal__dIUiC",modalContent:"dm_modalContent__OOhLU",applyButton2:"dm_applyButton2__9F8u0",closeButton:"dm_closeButton__HjXB_",modalTitle:"dm_modalTitle__YqKhx",modalMsgContent:"dm_modalMsgContent__spYBA",modalMsg:"dm_modalMsg__SGEHO",dateTimePicker:"dm_dateTimePicker__nfxc6",dateInput:"dm_dateInput__Z18_V",timeInput:"dm_timeInput__z2TJx",dateMsg:"dm_dateMsg__vk01P",timeMsg:"dm_timeMsg__IpxTz",title:"dm_title__gZ2cL"}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=7622)}),_N_E=e.O()}]);