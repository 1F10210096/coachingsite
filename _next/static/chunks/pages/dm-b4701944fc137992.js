(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{7622:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dm",function(){return n(2661)}])},2661:function(e,s,n){"use strict";n.r(s);var t=n(5893),a=n(7596),l=n.n(a),o=n(6718),i=n(1163),d=n(7294),c=n(8759),r=n(2509),m=n(7952),_=n.n(m);s.default=()=>{var e;let[s,n]=(0,d.useState)(""),[a,m]=(0,d.useState)(""),[u,g]=(0,d.useState)(0),[p,h]=(0,d.useState)(""),[x,v]=(0,d.useState)([]),[f,y]=(0,d.useState)(null),[N,j]=(0,d.useState)(void 0),C=(0,i.useRouter)(),I=C.query.id,fetchRecruitDetail=async()=>{try{console.log(s);let e=await c.x.userReview.post({body:{Id:s}});if(console.log(e),j(e.body),"string"==typeof I){let e=await c.x.fetachRoomRecruitDetail.post({body:{Id:I}});console.log(e),y(e.body)}}catch(e){console.error("ゲームの取得に失敗しました:",e)}};(0,d.useEffect)(()=>{s&&fetchRecruitDetail()},[s]),(0,d.useEffect)(()=>{let e=(0,r.lh)(),s=(0,o.Aj)(e,e=>{e&&(console.log(e),n(e.uid))});return()=>s()},[]);let fetchRoom=async()=>{try{if("string"==typeof I){console.log(I);let e=await c.x.fetchRoom.post({body:{Id:I,userId:s}});console.log(e),console.log("dadaddfffffffff");let n=await c.x.fetchUserInfo.post({body:{Id:I,userId:s}});console.log(n.body),g(n.body)}}catch(e){console.error("ゲームの取得に失敗しました:",e)}};(0,d.useEffect)(()=>{s&&fetchRoom()},[s]);let sendMessage=async()=>{if(!B||B.readyState!==WebSocket.OPEN){console.error("WebSocketが開いていません");return}let e={type:"message",userImageUrl:null==N?void 0:N.imageUrl,roomId:I,userId:s,content:a};console.log(e),await c.x.sendMessage.post({body:{Id:I,userId:s,message:a}}),B.send(JSON.stringify(e)),fetchRoom()},[B,b]=(0,d.useState)(null),[k,S]=(0,d.useState)("");(0,d.useEffect)(()=>{if("string"==typeof s&&""!==s.trim()){let e=new WebSocket("ws://localhost:8000?userId=".concat(s));return console.log(e),e.onopen=function(){console.log("サーバーに接続しました"),e.send("こんにちは、サーバー！")},e.onmessage=function(e){let s=JSON.parse(e.data);console.log("[message] データを受信しました: ",s),"url"===s.type?(K(s.url),L(s.time),U(s.date),O(!1),console.log("承諾用URLを受信しました:",s.url),console.log(s.gameId),S(s.gameId),console.log(f)):"new-message"===s.type?(console.log("新しいメッセージを受信しました:",s),v(e=>[...e,s])):fetchRoom()},b(e),()=>{e.close()}}},[s]),console.log(x);let createApprovalUrl=e=>"https://yourapp.com/approve?roomId=".concat(e),sendApply=async()=>{var e;if(console.log(p),await c.x.sendApprove.post({body:{bosyuuId:null!==(e=null==f?void 0:f.id)&&void 0!==e?e:"defaultId",roomId:I,userId:s,date:E,time:P}}),!B||B.readyState!==WebSocket.OPEN){console.error("WebSocketが開いていません");return}if("string"==typeof I){let e=createApprovalUrl(I),n={type:"apply",roomId:I,userId:s,userNumber:u,url:e,gameTitle:null==f?void 0:f.title,gameId:null==f?void 0:f.gameId,date:E,time:P};B.send(JSON.stringify(n)),console.log("承諾用URLを送信しました:",e),window.confirm("承諾用URLを送信しました")}},handleUrlClick=async()=>{let e=window.confirm("本当に承諾しますか？");if(e){console.log(D),console.log(I),console.log(s),O(!1);try{"string"==typeof I&&"string"==typeof D&&"string"==typeof p&&"string"==typeof s&&await c.x.recruitApprove.post({body:{Id:D,bosyuuId:p,roomId:I,userId:s}})}catch(e){console.error("Error updating status:",e)}}},[w,R]=(0,d.useState)(!1),[T,A]=(0,d.useState)(!1),[M,O]=(0,d.useState)(!1),onCloseRecruit=()=>{R(!1)},onFinalClose=()=>{R(!1)},onApplyRecruit=()=>{R(!1),A(!0)},onApplyFinalRecruit=()=>{A(!1),sendApply()},[E,U]=(0,d.useState)(""),[P,L]=(0,d.useState)(""),handleDateChange=e=>{U(e.target.value)},handleTimeChange=e=>{L(e.target.value)},[F,W]=(0,d.useState)(),fetchApplay=async()=>{try{console.log(I);let e=await c.x.fetchApplay.post({body:{id:I}});console.log(e.body),W(e.body),L(e.body.time),U(e.body.date)}catch(e){l()(e)}};(0,d.useEffect)(()=>{fetchApplay()},[I]);let[D,K]=(0,d.useState)("");return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:_().container}),(0,t.jsxs)("div",{className:_().parent,children:[(0,t.jsxs)("div",{className:_().messageBox,children:[(0,t.jsxs)("div",{className:_().messageBox2,children:[(0,t.jsx)("div",{className:_().messageBox1,children:"チャット欄"}),(0,t.jsx)("div",{className:_().line})]}),(0,t.jsx)("div",{className:_().messageBox3,children:Array.isArray(x)&&x.map((e,s)=>(0,t.jsx)("div",{className:1===e.userIdentity?_().messageLeft:_().messageRight,children:(0,t.jsxs)("div",{className:_().messageContainer,children:[(0,t.jsx)("img",{src:e.userImageUrl,alt:"User",className:_().userImage2}),(0,t.jsx)("div",{className:_().msgContent,children:e.content})," "]})},s))}),(0,t.jsx)("div",{className:_().line2}),(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{type:"text",value:a,onChange:e=>m(e.target.value),className:_().messageInput}),(0,t.jsx)("button",{onClick:sendMessage,className:_().sendButton,children:"Send"}),1===u&&(0,t.jsx)("button",{onClick:()=>{R(!0)},className:_().applayButton,children:"申し込む"}),w&&(0,t.jsx)(function(e){let{isOpen:s}=e;return s?(0,t.jsx)("div",{className:_().modal,children:(0,t.jsxs)("div",{className:_().modalContent,children:[(0,t.jsxs)("div",{className:_().modalMsgContent,children:[(0,t.jsx)("div",{className:_().modalTitle,children:"お申込み確認"}),(0,t.jsx)("div",{className:_().modalMsg,children:"日付と時間を設定してください"}),(0,t.jsxs)("div",{className:_().dateTimePicker,children:[(0,t.jsx)("input",{type:"date",className:_().dateInput,value:E,onChange:handleDateChange}),(0,t.jsx)("input",{type:"time",className:_().timeInput,value:P,onChange:handleTimeChange})]})]}),(0,t.jsx)("button",{className:_().closeButton,onClick:onCloseRecruit,children:"閉じる"}),(0,t.jsx)("button",{className:_().applyButton2,onClick:onApplyRecruit,children:"申し込む"})]})}):null},{isOpen:w}),T&&(0,t.jsx)(function(e){let{isOpen:s}=e;return s?(0,t.jsx)("div",{className:_().modal,children:(0,t.jsxs)("div",{className:_().modalContent,children:[(0,t.jsxs)("div",{className:_().modalMsgContent,children:[(0,t.jsx)("div",{className:_().modalTitle,children:"最終お申込み確認"}),(0,t.jsx)("p",{className:_().title,children:null==f?void 0:f.title}),(0,t.jsx)("p",{className:_().title,children:null!==f&&(null==f?void 0:f.gameId)!==null&&(e=>{switch(e){case 1:return"VALORANT";case 2:return"APEX";case 3:return"LOL";default:return"Unknown Game"}})(f.gameId)}),(0,t.jsxs)("div",{className:_().dateMsg,children:["日時：",E]}),(0,t.jsxs)("div",{className:_().timeMsg,children:["時間：",P]}),(0,t.jsx)("div",{children:"本当に申し込みますか？"})]}),(0,t.jsx)("button",{className:_().closeButton,onClick:onFinalClose,children:"閉じる"}),(0,t.jsx)("button",{className:_().applyButton2,onClick:onApplyFinalRecruit,children:"申し込む"})]})}):null},{isOpen:T}),F&&2===u&&(0,t.jsx)("div",{onClick:()=>{O(!0)},className:_().applayButton2,children:"受諾ボタン"}),M&&(0,t.jsx)(function(e){let{isOpen:s}=e;return s?(console.log(k),console.log(null==f?void 0:f.gameId),(0,t.jsx)("div",{className:_().modal,children:(0,t.jsxs)("div",{className:_().modalContent,children:[(0,t.jsxs)("div",{className:_().modalMsgContent,children:[(0,t.jsx)("div",{className:_().modalTitle,children:"最終受諾確認"}),(0,t.jsx)("p",{className:_().title,children:null==f?void 0:f.title}),(0,t.jsxs)("p",{className:_().title,children:[" ",null!==f&&(null==f?void 0:f.gameId)!==null&&(e=>{switch(e){case 1:return"VALORANT";case 2:return"APEX";case 3:return"LOL";default:return"Unknown Game"}})(f.gameId)]}),(0,t.jsxs)("div",{className:_().dateMsg,children:["日時：",E]}),(0,t.jsxs)("div",{className:_().timeMsg,children:["時間：",P]}),(0,t.jsx)("div",{children:"本当に了承しますか？"})]}),(0,t.jsx)("button",{className:_().closeButton,onClick:onFinalClose,children:"閉じる"}),(0,t.jsx)("button",{className:_().applyButton2,onClick:handleUrlClick,children:"了承する"})]})})):null},{isOpen:M})]})]}),(0,t.jsxs)("div",{className:_().profileContainer,children:[(0,t.jsx)("img",{src:null==N?void 0:N.imageUrl,alt:null==N?void 0:N.name,className:_().userImage}),(0,t.jsx)("div",{className:_().nameContainer,children:(0,t.jsx)("div",{className:_().name,children:null==N?void 0:N.name})}),(0,t.jsx)("div",{className:_().ratingContainer,children:(0,t.jsxs)("span",{className:_().rate,children:["★★★★★",(null==N?void 0:N.rating)&&(0,t.jsx)("span",{className:_().rateInner,style:{width:"".concat((console.log(30*(e=N.rating)),30*e),"px")},children:"★★★★★"})]})}),(0,t.jsx)("div",{className:_().rating,children:null==N?void 0:N.rating}),(0,t.jsxs)("div",{className:_().achievementsContainer,children:[(0,t.jsx)("div",{className:_().achievementsTitle,children:"【実績】"}),(0,t.jsx)("div",{className:_().achievements,children:null==N?void 0:N.Achievements})]}),(0,t.jsxs)("div",{className:_().descriptionDetailContainer,children:[(0,t.jsx)("div",{className:_().descriptionTitle,children:"【自己紹介】"}),(0,t.jsx)("div",{className:_().descriptions,children:null==N?void 0:N.hitokoto})]})]})]})]})}},7952:function(e){e.exports={loginContainer:"dm_loginContainer__CCPlz",loginForm:"dm_loginForm__830B9",loginButton:"dm_loginButton__bYjr2",container:"dm_container__2f5yO",loginTitle:"dm_loginTitle__eKnWK",kaninn:"dm_kaninn__gjHtq",searchmail:"dm_searchmail__2PwK5",searchInput:"dm_searchInput__wQgq8",mail:"dm_mail__Bid1P",password:"dm_password__KmriP",searchpass:"dm_searchpass__13_MN",messageInput:"dm_messageInput__eN8v9",sendButton:"dm_sendButton__yskkT",message:"dm_message__mIpbB",left:"dm_left__SxOKW",right:"dm_right__8zo2a",messageLeft:"dm_messageLeft__EmXrF",messageRight:"dm_messageRight__4t_2j",messageContainer:"dm_messageContainer__2_NLT",msgContent:"dm_msgContent__Ey1f4",userImage2:"dm_userImage2__GHH_u",messageBox:"dm_messageBox__yUvsV",messageBox3:"dm_messageBox3__BNIuO",messageBox2:"dm_messageBox2__9nfCa",messageBox1:"dm_messageBox1__xp6lP",line:"dm_line__X6Bnx",line2:"dm_line2__15k7S",applayButton:"dm_applayButton__ksAaZ",applayButton2:"dm_applayButton2__Plf02",profileContainer:"dm_profileContainer__o_e3U",userImage:"dm_userImage__vYxfZ",ratingContainer:"dm_ratingContainer__b72h9",rate:"dm_rate__vTFSP",rateInner:"dm_rateInner__rRs1E",rating:"dm_rating__AuLoY",name:"dm_name__fgJC8",nameContainer:"dm_nameContainer__tOq_9",achievementsContainer:"dm_achievementsContainer__AyLKI",achievements:"dm_achievements__PScWa",achievementsTitle:"dm_achievementsTitle__dvWMy",descriptionDetailContainer:"dm_descriptionDetailContainer__g8IjQ",descriptionTitle:"dm_descriptionTitle__g1_R6",descriptions:"dm_descriptions__CxZbx",parent:"dm_parent__Sx_RC",modal:"dm_modal__dIUiC",modalContent:"dm_modalContent__OOhLU",applyButton2:"dm_applyButton2__9F8u0",closeButton:"dm_closeButton__HjXB_",modalTitle:"dm_modalTitle__YqKhx",modalMsgContent:"dm_modalMsgContent__spYBA",modalMsg:"dm_modalMsg__SGEHO",dateTimePicker:"dm_dateTimePicker__nfxc6",dateInput:"dm_dateInput__Z18_V",timeInput:"dm_timeInput__z2TJx",dateMsg:"dm_dateMsg__vk01P",timeMsg:"dm_timeMsg__IpxTz",title:"dm_title__gZ2cL"}}},function(e){e.O(0,[596,774,888,179],function(){return e(e.s=7622)}),_N_E=e.O()}]);